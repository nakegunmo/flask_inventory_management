# Flask Inventory System

このプロジェクトは、Flask と SQLite を使用した簡易在庫管理システムです。\
`main_light.py` を実行するだけで、SQLite のデータベースが自動的に作成され、各種エンドポイントから在庫や売上の管理が可能になります。

## 必要なもの

- Python 3.x
- Flask
- Flask-SQLAlchemy

## インストール方法

1. **パッケージのインストール**

   ターミナルで以下のコマンドを実行してください：

   ```bash
   pip install flask flask_sqlalchemy
   ```

2. **システムのロケール警告の回避（任意）**

   Ubuntu などの場合、ロケール警告を回避するために以下を実行してください：

   ```bash
   sudo apt install locales-all
   ```

## 実行方法

1. プロジェクトディレクトリに移動します。

2. 以下のコマンドでサーバーを起動します：

   ```bash
   python3 main_light.py
   ```

3. サーバーは `http://localhost:5000` で起動します。

## 各エンドポイントの説明と使用例

**注意:** エンドポイントを実行する際は、サーバーを起動したターミナルとは別のターミナルを開いて実行してください。

### 1. アイテムの追加 (POST `/v1/stocks`)

- **説明:**

  - アイテム名はアルファベットの大文字・小文字のみを許可し、8文字以内でなければなりません。
  - `amount` パラメータで追加する個数を指定できます。指定しなかった場合はデフォルトで 1 個が追加されます。

- **使用例:**\
  アイテム "aaa" を 5 個追加する場合：

  ```bash
  curl -X POST -H "Content-Type: application/json" -d '{"name": "aaa", "amount": 5}' http://localhost:5000/v1/stocks
  ```

### 2. 特定アイテムの在庫取得 (GET `/v1/stocks/<name>`)

- **説明:**\
  指定したアイテム名の在庫数を取得します。\
  アイテムが存在しない場合は、在庫が 0 として返されます。

- **使用例:**\
  アイテム "aaa" の在庫を確認する場合：

  ```bash
  curl http://localhost:5000/v1/stocks/aaa
  ```

### 3. 全アイテムの在庫取得 (GET `/v1/stocks`)

- **説明:**\
  登録されている全アイテムの在庫を JSON 形式で返します。

- **使用例:**

  ```bash
  curl http://localhost:5000/v1/stocks
  ```

### 4. 売上の登録 (POST `/v1/sales`)

- **説明:**\
  指定したアイテムを購入するエンドポイントです。

  - 購入する個数（`amount`）と価格（`price`）を指定します。
  - 在庫が十分にある場合、在庫数が減少し、売上に価格×個数が記録されます。
  - `price` が指定されない場合は、在庫の減少のみ行われ、売上は記録されません（在庫調整用エンドポイント）。

- **使用例:**\
  アイテム "aaa" を 1 個、価格 100 で購入する場合：

  ```bash
  curl -X POST -H "Content-Type: application/json" -d '{"name": "aaa", "amount": 1, "price": 100}' http://localhost:5000/v1/sales
  ```

### 5. 全体の売上表示 (GET `/v1/sales`)

- **説明:**\
  Sales テーブルに記録された全ての売上の合計金額を返します。\
  売上が存在しない場合は 0 として返されます。

- **使用例:**

  ```bash
  curl http://localhost:5000/v1/sales
  ```

### 6. アイテムごとの売上表示 (GET `/v1/sales/<name>`)

- **説明:**\
  指定したアイテムの売上を取得します。\
  該当する売上が存在しない場合は 0 として返されます。

- **使用例:**

  ```bash
  curl http://localhost:5000/v1/sales/aaa
  ```

### 7. 全削除エンドポイント (DELETE `/v1/stocks`)

- **説明:**\
  このエンドポイントを呼び出すと、Sales テーブルと Item テーブルの全レコードが削除され、データベースのテーブルがリセットされます。\
  リセット後、再度 `db.create_all()` によりテーブルは作成されます。

- **使用例:**

  ```bash
  curl -X DELETE http://localhost:5000/v1/stocks
  ```

## まとめ

- **在庫管理:**\
  アイテムの追加、特定アイテムまたは全アイテムの在庫取得が可能です。

- **売上管理:**\
  売上の登録、全体およびアイテムごとの売上表示が可能です。

- **データリセット:**\
  全削除エンドポイントを利用して、Sales テーブルと Item テーブルの全レコードを削除し、データベースをリセットできます。


